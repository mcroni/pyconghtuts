<!DOCTYPE html>
<!-- saved from url=(0066)http://rahmonov.me/posts/run-a-django-app-with-nginx-and-gunicorn/ -->
<html lang="en"><script async="" src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/analytics.js.download"></script><script type="text/javascript" charset="utf-8" id="zm-extension" src="chrome-extension://fdcgdnkidjaadafnichfpabhfomcebme/scripts/webrtc-patch.js" async=""></script><head prefix="og: http://ogp.me/ns#"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)</title><link rel="stylesheet" href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/main.css"><link rel="stylesheet" href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/pygment.css"><link rel="stylesheet" href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/font-awesome.min.css"><link href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/lightbox.min.css"><link href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/emoji.css" rel="stylesheet"><link rel="shortcut icon" type="image/png" href="http://rahmonov.me/static/images/favicon.png"><meta name="google-site-verification" content="RhKly6bfyZ4vo03CPdY9f-Bg8CuZA0GhTPvCEPsNa2c"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="&lt;p&gt;How to run a Django app with Nginx and Gunicorn&lt;/p&gt;"><meta name="author" content="Jahongir Rahmonov"><meta property="og:title" content="Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)"><meta property="og:type" content="website"><meta property="og:image" content="/static/images/programming.jpg"><meta property="og:url" content="http://rahmonov.me/posts/run-a-django-app-with-nginx-and-gunicorn/"><meta property="og:description" content="&lt;p&gt;How to run a Django app with Nginx and Gunicorn&lt;/p&gt;"><link href="http://rahmonov.me/feeds/atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Full Atom Feed"><link href="http://rahmonov.me/feeds/rss.xml" type="application/rss+xml" rel="alternate" title="Jahongir Rahmonov Full RSS Feed"><link href="http://rahmonov.me/feeds/programming.atom.xml" type="application/atom+xml" rel="alternate" title="Jahongir Rahmonov Categories Atom Feed"><meta name="description" content="&lt;p&gt;How to run a Django app with Nginx and Gunicorn&lt;/p&gt;"><meta name="tags" content="python"><meta name="tags" content="django"><meta name="tags" content="gunicorn"><meta name="tags" content="nginx"><link href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/likely.css" rel="stylesheet"><script src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/likely.js.download" type="text/javascript"></script><script type="text/javascript" async="" src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/embed.js.download"></script><link rel="preload" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.3999ac261b914f8b8b5e85df0ff3eaea.css"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.5f8e47303ecf1055cd7c6905466d140a.js"><link rel="preload" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.33067ddbd4792de0b384ceb588602715.js"><link rel="preload" as="script" href="https://disqus.com/next/config.js"></head><body id="index" class="home"><div class="container"><button class="nav js-mobile"><i class="fa fa-bars"></i></button><div class="side"><div class="logo"><a href="http://rahmonov.me/"><img src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/me.jpg" width="150" height="150" class="jahon" alt="Jahongir Rahmonov"></a></div><h2>Jahongir Rahmonov</h2><div class="paragraphs"><p> I'm a Software Developer at <a href="http://mysuperdispatch.com/">Super Dispatch (TechStars '16)</a>. Avid reader. <a href="http://wiut.uz/">WIUT</a> graduate. Blogger and an amateur speaker </p><p> I write about Python, Django, AngularJS and sometimes something non-technical. </p><p> Welcome to my corner <i class="em em-snake"></i></p> </div><form method="get" action="https://www.google.com/search"><input name="sitesearch" value="rahmonov.me" type="hidden"><input type="text" id="search-query" class="field field-text" required="" name="q" placeholder="Search..." autocomplete="off"><input type="image" src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/search-icon.png" width="20" height="20" class="search-icon" title="Search via Google" alt="Search via Google"></form><ul class="menu"><li><a href="http://rahmonov.me/">Home</a></li><li><a href="http://rahmonov.me/pages/about.html">About</a></li><li><a href="http://rahmonov.me/pages/about.html#subscribe">Subscribe</a></li><li><a href="http://rahmonov.me/pages/about.html#contact">Contact</a></li><li><a href="http://rahmonov.me/feeds/atom.xml">RSS <i class="fa fa-rss"></i></a></li></ul><p class="profiles"><a title="GitHub" href="https://github.com/rahmonov"><i class="fa fa-github-square"></i></a><a title="StackOverflow" href="https://stackoverflow.com/users/4137194/jahongir-rahmonov?tab=profile"><i class="fa fa-stack-overflow"></i></a><a title="Twitter" href="https://twitter.com/the_rahmonov"><i class="fa fa-twitter-square"></i></a><a title="Facebook" href="https://www.facebook.com/rahmonovj"><i class="fa fa-facebook-official"></i></a><a title="Instagram" href="https://www.instagram.com/rahmonov.me/"><i class="fa fa-instagram"></i></a><a title="LinkedIn" href="https://www.linkedin.com/in/jahongirrahmonov"><i class="fa fa-linkedin-square"></i></a></p></div><div class="wrap"><div class="content"><h4>Sun 26 February 2017</h4><h1>Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)</h1><div class="entry-content"><p>This tutorial is the continuation of <a href="http://rahmonov.me/posts/run-a-django-app-with-gunicorn-in-ubuntu-16-04/">this one</a> where we learned how to run a django app with gunicorn. Now we will add Nginx into the mix.</p><h2>The reason we need Nginx</h2><p>If you followed the previous tutorial, we ran our django app with Gunicorn. However, at the end, we saw that the styles of the admin panel were gone. The reason is that Gunicorn is an application server and just runs the app (django app in our case) and django, as we know, does not serve static files except in development. Nginx to the rescue! It will be a reverse proxy for Gunicorn. What the hell is a reverse proxy? Good question! We all know what VPNs are, right? We use them to access some website that is blocked for some reason. In this case, we access that website through a VPN: We -&gt; VPN -&gt; some website. This kind of proxies are called Forward Proxies. As for reverse proxies, think of them as forced proxies. For example, a user is trying to access our django app running in gunicorn. He thinks that he is accessing the app directly. However, what is happening is that he is first accessing the Nginx server which decides what to do next. If the user is accessing a static file, the Nginx server will serve it itself. Otherwise, it will redirect it to Gunicorn. In plain terms, http requests will be handled by Gunicorn and static ones by Nginx. That's why we need Nginx.</p><p>Apart from that, Nginx also improves performance, reliability, security and scale.</p><h2>Installation</h2><p>By now we already have Django and Gunicorn ready. So, let's install Nginx now:</p><div class="highlight"><pre><span></span>sudo apt-get install nginx
</pre></div><p>Now, we will configure Nginx to pass traffic to the process.</p><p>Create a file <code>/etc/nginx/sites-available/djtrump</code> and type in the following:</p><div class="highlight"><pre><span></span>server <span class="o">{</span>
    listen 8000<span class="p">;</span>
    server_name 0.0.0.0<span class="p">;</span>

    <span class="nv">location</span> <span class="o">=</span> /favicon.ico <span class="o">{</span> access_log off<span class="p">;</span> log_not_found off<span class="p">;</span> <span class="o">}</span>

    location /static/ <span class="o">{</span>
            root /home/ubuntu/myproject<span class="p">;</span>
    <span class="o">}</span>

    location / <span class="o">{</span>
            include proxy_params<span class="p">;</span>
            proxy_pass http://unix:/home/ubuntu/myproject/myproject.sock<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div><p>Adjust the paths such as <code>/home/ubuntu/myproject</code> to your own environment.</p><p>Let's see what is going on here.</p><p>The first two lines tell that it will listen to the port <code>8000</code> on <code>0.0.0.0</code>. The next line about favicon will tell Nginx to ignore problems with favicon.ico.</p><p>The next block is very important. It says that static files, which all have a standard URI prefix of <code>static/</code> should be looked for in <code>~/myproject/static/</code> folder.</p><p>And the last location block matches all other requests other that static ones (remember reverse proxy). One thing to note here is that Nginx and Gunicorn "talk to" each other through a unix socket. That's why we will bind our gunicorn to a socket as we will see soon.</p><p>Now, let's enable this file by linking it to the <code>sites-enabled</code> folder:</p><div class="highlight"><pre><span></span>sudo ln -s /etc/nginx/sites-available/myproject /etc/nginx/sites-enabled
</pre></div><p>and check if our configuration file was correctly written:</p><div class="highlight"><pre><span></span>sudo nginx -t
</pre></div><p>If everything is OK, you should see something like this:</p><div class="highlight"><pre><span></span>nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test</span> is successful
</pre></div><p>You may ask what all that linking and <code>sites-enabled</code> folder were about. We could have included those settings in Nginx's main settings file: <code>/etc/nginx/nginx.conf</code>. If we take a look at it, we will see this:</p><div class="highlight"><pre><span></span>include /etc/nginx/sites-enabled/*
</pre></div><p>So, we can see that what we did makes it more modular and much easier to maintain when we have several apps being served by Nginx.</p><p>OK, now that we have configured Nginx, let's see some action.</p><p>First, let's move all our static files to <code>~/myproject/static/</code> because we set up Nginx to look for them there. Open up <code>myproject/settings.py</code> and add this:</p><div class="highlight"><pre><span></span><span class="nv">STATIC_ROOT</span> <span class="o">=</span> os.path.join<span class="o">(</span>BASE_DIR, <span class="s1">'static/'</span><span class="o">)</span>
</pre></div><p>Save and close. Now, let's collect them to that folder:</p><div class="highlight"><pre><span></span>./manage.py collectstatic
</pre></div><p>Confirm the operation and our static files should be there for Nginx to find them.</p><p>Now, let's finally run our app:</p><div class="highlight"><pre><span></span>gunicorn --daemon --workers <span class="m">3</span> --bind unix:/home/ubuntu/myproject/myproject.sock myproject.wsgi
</pre></div><p>As I told earlier, we are starting gunicorn a little differently now. We are binding it to a unix socket file which is needed to talk to Nginx. This file will be created and enable Nginx and Gunicorn to talk to each other. You may ask what about ports and ip?. Nginx will take care of that. Remember we configured it to listen to <code>0.0.0.0:8000</code>? Cool! Now, let's restart Nginx to make these changes take effect.</p><div class="highlight"><pre><span></span>sudo service nginx restart
</pre></div><p>Now, go ahead and access <code>0.0.0.0:8000</code>. Great, our app is running. Let's check our admin panel now at <code>0.0.0.0:8000/admin</code>. Awesome, styles are there! We have achieved what we wanted. Congratulations!</p><p>This is just the tip of the iceberg. You will need more stuff as your app grows. Go to <a href="https://nginx.org/en/docs/">nginx docs</a> to learn more.</p><p>In the next tutorial, we will take a look at <code>supervisord</code> to make process management very easy.</p><p>Fight on!</p><p><a href="http://rahmonov.me/posts/run-a-django-app-with-gunicorn-in-ubuntu-16-04/">Part I</a></p><p><a href="http://rahmonov.me/posts/run-a-django-app-with-nginx-gunicorn-and-supervisor/">Part III</a></p></div><div class="pagination clearfix"><a class="prev" href="http://rahmonov.me/posts/run-a-django-app-with-gunicorn-in-ubuntu-16-04/">« Previous</a><a class="next" href="http://rahmonov.me/posts/run-a-django-app-with-nginx-gunicorn-and-supervisor/">Next »</a></div><p></p><div class="likely likely-big likely_visible likely_ready"><div class=" likely__widget likely__widget_facebook"><span class="likely__icon likely__icon_facebook"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M15.117 0H.883C.395 0 0 .395 0 .883v14.234c0 .488.395.883.883.883h7.663V9.804H6.46V7.39h2.086V5.607c0-2.066 1.262-3.19 3.106-3.19.883 0 1.642.064 1.863.094v2.16h-1.28c-1 0-1.195.48-1.195 1.18v1.54h2.39l-.31 2.42h-2.08V16h4.077c.488 0 .883-.395.883-.883V.883C16 .395 15.605 0 15.117 0z"></path></svg></span><span class="likely__button likely__button_facebook">Share</span><span class="likely__counter likely__counter_facebook">4</span></div><div class=" likely__widget likely__widget_twitter" data-via="rahmon0v"><span class="likely__icon likely__icon_twitter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg></span><span class="likely__button likely__button_twitter">Tweet</span></div><div class=" likely__widget likely__widget_telegram"><span class="likely__icon likely__icon_telegram"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M6,11.960784l-1,-3l11,-8l-15.378,5.914c0,0 -0.672,0.23 -0.619,0.655c0.053,0.425 0.602,0.619 0.602,0.619l3.575,1.203l1.62,5.154l2.742,-2.411l-0.007,-0.005l3.607,2.766c0.973,0.425 1.327,-0.46 1.327,-0.46l2.531,-13.435l-10,11zz"></path></svg></span><span class="likely__button likely__button_telegram">Send</span></div><div class=" likely__widget likely__widget_linkedin"><span class="likely__icon likely__icon_linkedin"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path d="M2.4,6h2.4v7.6H2.4V6z M3.6,2.2c0.8,0,1.4,0.6,1.4,1.4C4.9,4.3,4.3,5,3.6,5C2.8,5,2.2,4.3,2.2,3.6C2.2,2.8,2.8,2.2,3.6,2.2C3.6,2.2,3.6,2.2,3.6,2.2 M6.2,6h2.3v1h0C9,6.2,9.9,5.8,10.8,5.8c2.4,0,2.8,1.6,2.8,3.6v4.2h-2.4V9.9c0-0.9,0-2-1.2-2c-1.2,0-1.4,1-1.4,2v3.8H6.2V6z M13,0H3C1,0,0,1,0,3v10c0,2,1,3,3,3h10c2,0,3-1,3-3V3C16,1,15,0,13,0zz"></path></svg></span><span class="likely__button likely__button_linkedin">Share</span></div></div><p></p><div class="end"><span> If you liked what you read, subscribe below. Once in a while, I will send you a list of my new posts. </span><div id="popup"><p><link href="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/classic-10_7.css" rel="stylesheet" type="text/css"><style type="text/css">
                #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
                /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
                   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
            </style></p><div id="mc_embed_signup"><form action="http://rahmonov.us16.list-manage.com/subscribe/post?u=9e30bdfdfe0a7bd7cf7e0d50a&amp;id=af3f3c5f76" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate=""><div id="mc_embed_signup_scroll"><div class="indicates-required"><span class="asterisk">*</span> indicates required</div><div class="mc-field-group"><label for="mce-MMERGE1">Name </label><input type="text" value="" name="MMERGE1" class="" id="mce-MMERGE1"></div><div class="mc-field-group"><label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div><div id="mce-responses" class="clear"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div> <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9e30bdfdfe0a7bd7cf7e0d50a_af3f3c5f76" tabindex="-1" value=""></div><div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div></div></form></div><p></p></div></div><div id="disqus_thread"><iframe id="dsq-app4873" name="dsq-app4873" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 2295px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe><iframe id="indicator-north" name="indicator-north" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 909px !important; border: none !important; overflow: hidden !important; top: 0px !important; min-width: 909px !important; max-width: 909px !important; position: fixed !important; z-index: 2147483646 !important; height: 18px !important; min-height: 18px !important; max-height: 18px !important; display: none !important;" src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/saved_resource(2).html"></iframe><iframe id="indicator-south" name="indicator-south" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" style="width: 909px !important; border: none !important; overflow: hidden !important; bottom: 0px !important; min-width: 909px !important; max-width: 909px !important; position: fixed !important; z-index: 2147483646 !important; height: 18px !important; min-height: 18px !important; max-height: 18px !important; display: none !important;" src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/saved_resource(3).html"></iframe></div><script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = 'jrahmonov';

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div></div><script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-67392250-1', 'auto');
      ga('send', 'pageview');
    </script><script src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/jquery.min.js.download"></script><script src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/mobile.js.download"></script><script src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/lightbox.min.js.download"></script><script src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/saved_resource"></script><div id="lightboxOverlay" class="lightboxOverlay" style="display: none;"></div><div id="lightbox" class="lightbox" style="display: none;"><div class="lb-outerContainer"><div class="lb-container"><img class="lb-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="><div class="lb-nav"><a class="lb-prev" href="http://rahmonov.me/posts/run-a-django-app-with-nginx-and-gunicorn/"></a><a class="lb-next" href="http://rahmonov.me/posts/run-a-django-app-with-nginx-and-gunicorn/"></a></div><div class="lb-loader"><a class="lb-cancel"></a></div></div></div><div class="lb-dataContainer"><div class="lb-data"><div class="lb-details"><span class="lb-caption"></span><span class="lb-number"></span></div><div class="lb-closeContainer"><a class="lb-close"></a></div></div></div></div><iframe style="display: none;" src="./Run a Django app with Nginx and Gunicorn in Ubuntu 16.04 (Part II)_files/saved_resource(4).html"></iframe></body></html>